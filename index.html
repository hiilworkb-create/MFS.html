<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wizard · Skip Validation + Google Sheets</title>
  <style>
    :root{
      --bg:#0f1115; --card:#141820; --text:#e5e7eb; --muted:#9aa4b2;
      --border:#212836; --btn:#3b82f6; --btn-text:#fff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .wrap{max-width:860px;margin:0 auto;padding:20px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.25);padding:20px}
    h1{margin:0 0 12px;font-size:20px}
    .steps{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px}
    .step{padding:6px 10px;border-radius:999px;border:1px solid var(--border);color:var(--muted);opacity:.8}
    .step.active{background:var(--btn);color:var(--btn-text);border-color:transparent;opacity:1}
    label{display:block;margin:14px 0 6px}
    input,textarea{width:100%;background:#0b0f15;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:12px}
    small.err{display:block;min-height:1.2em;margin-top:6px;color:#ef4444}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .controls{display:flex;gap:10px;margin-top:16px}
    .btn{appearance:none;border:1px solid var(--border);background:#0b0f15;color:var(--text);padding:12px 14px;border-radius:12px;cursor:pointer}
    .btn.primary{background:var(--btn);color:var(--btn-text);border-color:transparent}
    .hidden{display:none}
    .preview{white-space:pre-wrap;background:#0b0f15;border:1px dashed var(--border);padding:12px;border-radius:12px;margin-top:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Мастер оформления</h1>
      <div id="steps" class="steps"></div>

      <!-- Шаг 1 -->
      <section class="page" data-step="1">
        <label>ФИО</label>
        <input id="fullname" placeholder="Иванов Иван Иванович" />
        <small id="err-fullname" class="err"></small>
      </section>

      <!-- Шаг 2 -->
      <section class="page hidden" data-step="2">
        <label>Телефон</label>
        <input id="phone" placeholder="+7 999 123-45-67" />
        <small id="err-phone" class="err"></small>
      </section>

      <!-- Шаг 3 -->
      <section class="page hidden" data-step="3">
        <label>Адрес</label>
        <input id="address" placeholder="Город, улица, дом, кв." />
        <small id="err-address" class="err"></small>
      </section>

      <!-- Шаг 4 -->
      <section class="page hidden" data-step="4">
        <div class="row">
          <div>
            <label>Документы (можно ничего не прикреплять)</label>
            <input id="documents" type="file" multiple />
            <small id="err-doc" class="err"></small>
          </div>
          <div>
            <label>Номер документа (опционально)</label>
            <input id="doc-number" placeholder="серия и номер / иной идентификатор" />
          </div>
        </div>
      </section>

      <!-- Шаг 5 -->
      <section class="page hidden" data-step="5">
        <label>Код подтверждения (опционально)</label>
        <input id="code" placeholder="XXXX-XXXX" />
        <small id="err-code" class="err"></small>

        <div id="browserPreview" class="preview hidden"></div>
      </section>

      <div class="controls">
        <button id="backBtn" class="btn">Назад</button>
        <button id="nextBtn" class="btn primary">Далее</button>
      </div>
    </div>
  </div>

  <script>
    /* ===== 1) НАСТРОЙКА ОТПРАВКИ В GOOGLE SHEETS (Apps Script) =====
       ЗАМЕНИ URL ниже на свой развернутый веб-приложением Apps Script */
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/PASTE_YOUR_DEPLOYED_APPS_SCRIPT_URL/exec';

    /* ===== 2) МИНИМАЛЬНЫЙ WIZARD С ОТКЛЮЧЕННОЙ ВАЛИДАЦИЕЙ ===== */
    const pages = [...document.querySelectorAll('.page')];
    let current = 1;

    const stepsBar = document.getElementById('steps');
    const backBtn = document.getElementById('backBtn');
    const nextBtn = document.getElementById('nextBtn');

    function render() {
      stepsBar.innerHTML = '';
      for (let i = 1; i <= pages.length; i++) {
        const el = document.createElement('div');
        el.className = 'step' + (i === current ? ' active' : '');
        el.textContent = `Шаг ${i}`;
        stepsBar.appendChild(el);
      }
      pages.forEach(p => p.classList.toggle('hidden', +p.dataset.step !== current));
      backBtn.disabled = current === 1;
      nextBtn.textContent = current === pages.length ? 'Отправить' : 'Далее';
    }

    function clearAllErrors() {
      ["err-fullname","err-phone","err-address","err-doc","err-code"]
        .forEach(id => { const el = document.getElementById(id); if (el) el.textContent = ""; });
    }

    // ВАЛИДАЦИЯ ОТКЛЮЧЕНА: всегда true
    function validate(/* step */) { clearAllErrors(); return true; }

    function next() {
      if (!validate(current)) return; // validate всегда true
      if (current < pages.length) {
        current++;
        render();
      } else {
        submitToSheet(); // на последнем шаге отправляем в таблицу
      }
    }
    function back() {
      if (current > 1) { current--; render(); }
    }

    backBtn.addEventListener('click', back);
    nextBtn.addEventListener('click', next);
    render();

    /* ===== 3) СБОР ДАННЫХ И ОТПРАВКА В ТАБЛИЦУ ===== */
    const $ = (id)=>document.getElementById(id);
    const filesMeta = (fileList) => !fileList ? [] : [...fileList].map(f => ({name:f.name,size:f.size,type:f.type}));

    function buildPayload(){
      return {
        source: 'miniapp',                 // метка на твой вкус
        fullname: $('#fullname')?.value?.trim() || '',
        phone:    $('#phone')?.value?.trim() || '',
        address:  $('#address')?.value?.trim() || '',
        doc_number: $('#doc-number')?.value?.trim() || '',
        code:     $('#code')?.value?.trim() || '',
        files:    filesMeta($('#documents')?.files), // только метаданные файлов
        ua:       navigator.userAgent
      };
    }

    async function submitToSheet(){
      const payload = buildPayload();

      try{
        const res = await fetch(https:1tjYgCcEab9Lgn-alSUKi2Ybc8Xv250Y3QsZ7yRkmgVo {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        const text = await res.text();
        try { console.log('Server:', JSON.parse(text)); } catch { console.log('Server:', text); }
        if (!res.ok) throw new Error('HTTP '+res.status);
        alert('Отправлено в таблицу!');
      }catch(err){
        // Если открываешь локально (file://) или URL не заменён — тут может быть CORS/HTTP ошибка
        alert('Ошибка отправки: ' + err.message);
        const box = document.getElementById('browserPreview');
        box.classList.remove('hidden');
        box.textContent = JSON.stringify(payload, null, 2);
      }
    }
  </script>
</body>
</html>
